function formatRangeRefinementTag(e,t,n,a){var i=e.getNumericRefinement(t,">="),r=e.getNumericRefinement(t,"<="),c=i>n?i||"":"",l=r<a?r||"":"",s="";return c.length>0&&(s+="min: €"+c),c.length>0&&l.length>0&&(s+=" - "),l.length>0&&(s+="max: €"+l),0==s.length?null:{title:s,value:"",facet:t,isNumeric:!0}}var Config={Algolia:{ApplicationId:"27B57MBLO4",APIKey:"b5e5a8c59bcef894668656bdef6f026b",IndexName:"best_buy",Facets:[{name:"categories",displayName:"Category",type:"disjunctive"},{name:"brand",displayName:"Brand",type:"disjunctive"},{name:"price",displayName:"Price",type:"slider"},{name:"type",displayName:"Type",type:"conjunctive"},{name:"rating",displayName:"Customer Rating",type:"rating"}],HitsPerPage:20}};$(document).ready(function(){$('[data-toggle="offcanvas"]').click(function(){$(".row-offcanvas").toggleClass("active")})}),$(document).ready(function(){function e(e){m.html(d.render({nbHits:e.nbHits,nbHits_plural:1!==e.nbHits}))}function t(e,t){if(0==e.nbHits)return void o.html(h.render({queryString:e.query}));e.hasNextPage=e.page<e.nbPages;var n=e.getFacetByName("rating")&&e.getFacetByName("rating").stats.max||0;e.hits.forEach(function(e){ratingStars=[];for(var t=0;t<n;t++)ratingStars.push({enabled:t<e.rating});e.ratingStars=ratingStars}),"undefined"!=typeof t?o.append(p.render(e)):o.html(p.render(e))}function n(e,t){var n="",a=[];Config.Algolia.Facets.forEach(function(i,r){var c=e.getFacetByName(i.name);if(c)if("conjunctive"==i.type||"disjunctive"==i.type){var l="conjunctive"==i.type?t.getConjunctiveRefinements(i.name):t.getDisjunctiveRefinements(i.name),s={facet:i.name,title:i.displayName,values:e.getFacetValues(i.name,{sortBy:["count:desc"]}),isDisjunctive:"disjunctive"==i.type,hasRefinements:l.length>0};n+=v.render(s);var m=l.map(function(e){return{value:e,title:e,facet:i.name,isNumeric:!1}});a=a.concat(m)}else if("slider"==i.type){var o=Math.floor(c.stats.min),u=Math.floor(c.stats.max),f=t.getNumericRefinement(i.name,">="),g=t.getNumericRefinement(i.name,"<="),d=f||o,p=g||u,l=(f||[])+(g||[]),h={facet:i.name,title:i.displayName,value:"["+d+", "+p+"]",min:o,max:u,step:5,hasRefinements:l.length>0};n+=y.render(h);var $=formatRangeRefinementTag(t,i.name,o,u);null!==$&&a.push($)}else if("rating"==i.type){var R=t.getNumericRefinement(i.name,">=")||[],x=e.getFacetValues(i.name).map(function(e){return{value:e.name,isRefined:R.includes(Number(e.name))}}).sort(function(e,t){return e.value>t.value?1:e.value<t.value?-1:0}),b={title:i.displayName,facet:i.name,values:x,hasRefinements:R.length>0};n+=N.render(b);var H=t.getNumericRefinement(i.name,">=")||null;if(null!==H){for(var P="",A=0;A<H;A++)P+='<span class="glyphicon glyphicon-star"></span>';a.push({value:H,title:"Min rating: "+P,facet:i.name,isNumeric:!0})}}}),u.html(n);var i="";a.forEach(function(e){i+=R.render(e)}),g.html(i)}function a(e){Config.Algolia.Facets.forEach(function(t,n){if("slider"==t.type){var a=u.find("#slider-"+t.name);if(!a.length)return;a.slider({tooltip_split:!0,handle:"custom",formatter:function(e){return"$"+e}}).on("slideStop",function(n){var a=$(this).data(),i=$(this).val().split(","),r={min:Number(i[0]),max:Number(i[1])},c=e.getNumericRefinement(t.name,">=");c=c&&c[0]||a.sliderMin,r.min!==c&&(l.removeNumericRefinement(t.name,">="),r.min!=a.sliderMin&&l.addNumericRefinement(t.name,">=",r.min),l.search());var s=e.getNumericRefinement(t.name,"<=");s=s&&s[0]||a.sliderMax,r.max!==s&&(l.removeNumericRefinement(t.name,"<="),r.max!=a.sliderMax&&l.addNumericRefinement(t.name,"<=",r.max),l.search())})}else if("rating"==t.type){var i=u.find("#rating-"+t.name);i.barrating({theme:"bootstrap-stars",initialRating:null,allowEmpty:null,deselectable:!0}),i.on("change",function(){var e=$(this).val();l.removeNumericRefinement(t.name,">="),e.length>0&&l.addNumericRefinement(t.name,">=",e),l.search()})}})}var i=[],r=[];Config.Algolia.Facets.forEach(function(e){"conjunctive"==e.type&&i.push(e.name),["disjunctive","slider","rating"].includes(e.type)&&r.push(e.name)});var c=algoliasearch(Config.Algolia.ApplicationId,Config.Algolia.APIKey),l=algoliasearchHelper(c,Config.Algolia.IndexName,{hitsPerPage:Config.Algolia.HitsPerPage,maxValuesPerFacet:8,facets:i,disjunctiveFacets:r,index:Config.Algolia.IndexName}),s=$("#search-input"),m=$("#stats"),o=$("#hits"),u=$("#facets"),f=$("#sort-by-select"),g=$("#refinement-tags"),d=Hogan.compile($("#stats-template").text()),p=Hogan.compile($("#hits-template").text()),h=Hogan.compile($("#no-results-template").text()),v=Hogan.compile($("#facet-template").text()),y=Hogan.compile($("#slider-template").text()),N=Hogan.compile($("#rating-template").text()),R=Hogan.compile($("#refinement-tag-template").text());s.on("input propertychange",function(e){var t=e.currentTarget.value;l.setQuery(t).search()}),l.on("error",function(e){console.log(e)}),l.on("result",function(i,r){l.getPage()>0?t(i,!0):(e(i),t(i),n(i,r),a(r))}),f.on("change",function(e){e.preventDefault(),l.setIndex(Config.Algolia.IndexName+$(this).val()).search()}),$(document).on("click",".facet-toggle",function(e){e.preventDefault(),l.toggleRefine($(this).data("facet"),$(this).data("value")).search()}),$(document).on("click",".facet-clear",function(e){e.preventDefault(),l.clearRefinements($(this).data("facet")).search()}),$(document).on("click",".refinement-tag",function(e){e.preventDefault(),$(this).data("isNumeric")===!0?l.removeNumericRefinement($(this).data("facet")).search():l.toggleRefine($(this).data("facet"),$(this).data("value")).search()}),$(document).on("click","#hits-next-page",function(e){e.preventDefault(),$(this).remove(),l.setPage(l.getPage()+1).search()}),$(".brand").on("click",function(e){l.clearRefinements().search()}),$(document).on("click",".clear-query-string",function(e){e.preventDefault(),s.val("").focus(),l.setQuery("").clearRefinements().search()}),l.search()});